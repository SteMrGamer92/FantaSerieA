name: Scraper Serie A

on:
  schedule:
    # ========== VENERDÃŒ ==========
    - cron: '30 19 * * 5'   # 20:30 IT (15 min prima)
    - cron: '45 21 * * 5'   # 22:45 IT (2h dopo inizio)
    
    # ========== SABATO ==========
    - cron: '45 13 * * 6'   # 14:45 IT
    - cron: '0 16 * * 6'    # 17:00 IT
    - cron: '45 16 * * 6'   # 17:45 IT
    - cron: '0 19 * * 6'    # 20:00 IT
    - cron: '30 19 * * 6'   # 20:30 IT
    - cron: '45 21 * * 6'   # 22:45 IT
    
    # ========== DOMENICA ==========
    - cron: '15 11 * * 0'   # 12:15 IT
    - cron: '30 13 * * 0'   # 14:30 IT
    - cron: '45 13 * * 0'   # 14:45 IT
    - cron: '0 16 * * 0'    # 17:00 IT
    - cron: '45 16 * * 0'   # 17:45 IT
    - cron: '0 19 * * 0'    # 20:00 IT
    - cron: '30 19 * * 0'   # 20:30 IT
    - cron: '45 21 * * 0'   # 22:45 IT

    # ========== LUNEDI ==========
    - cron: '45 16 * * 1'   # 17:45 IT
    - cron: '0 19 * * 1'    # 20:00 IT
    - cron: '30 19 * * 1'   # 20:30 IT
    - cron: '45 21 * * 1'   # 22:45 IT

    # ========== MARTEDI NEW ======
    - cron: '0 11 * * 2'   # 12:00 IT
  
  workflow_dispatch:

jobs:
  scrape:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4  # âœ… Aggiornato anche questo
      
      - name: ðŸ Setup Python 3.12
        uses: actions/setup-python@v5  # âœ… Aggiornato
        with:
          python-version: '3.12'
      
      - name: ðŸ“¦ Install dependencies
        run: |
          pip install playwright lxml pytz supabase
          playwright install chromium --with-deps
      
      - name: ðŸš€ Run scraper
        run: python scrap.py
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
        continue-on-error: true
      
      # âœ… UPLOAD ARTIFACT V4
      - name: ðŸ“¤ Upload HTML debug files
        if: always()
        uses: actions/upload-artifact@v4  # âœ… Versione aggiornata
        with:
          name: html-debug-files
          path: /tmp/match_*.html
          retention-days: 7
          if-no-files-found: warn  # âœ… Non fallire se non ci sono file
      
      # âœ… UPLOAD SCREENSHOT V4
      - name: ðŸ“¸ Upload screenshots
        if: always()
        uses: actions/upload-artifact@v4  # âœ… Versione aggiornata
        with:
          name: screenshots
          path: /tmp/screenshot_*.png
          retention-days: 7
          if-no-files-found: warn
      
      - name: ðŸ“Š Log risultato
        if: always()
        run: |
          echo "âœ… Scraping completato alle $(date)"
          echo "ðŸ“ File generati:"
          ls -lh /tmp/match_*.html 2>/dev/null || echo "  Nessun HTML"
          ls -lh /tmp/screenshot_*.png 2>/dev/null || echo "  Nessuno screenshot"
